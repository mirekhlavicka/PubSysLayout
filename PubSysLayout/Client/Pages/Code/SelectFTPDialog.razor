@inject HttpClient Http
@inject IJSRuntime js
@inject NavigationManager uriHelper
@inject MudBlazor.ISnackbar snackBar
@inject IDialogService DialogService
@inject CurrentDB currentDB

@using PubSysLayout.Shared.Model

<MudDialog DisableSidePadding="true">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Cable" Class="mr-3 mb-n1" />
            @MudDialog.Title
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudContainer Style="height: 150px; overflow-y: scroll">
        @if (FTPList == null)
        {
            <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
            <MudText Typo="Typo.subtitle1">Scanning FTP sites ...</MudText>
        }
        else
        {
            <MudList Clickable="true" SelectedItem="null">
                @foreach (var s in FTPList)
                {
                    <MudListItem Text='@($"{s}")' Icon="@Icons.Material.Filled.ArrowRightAlt" OnClick='() => MudDialog.Close(DialogResult.Ok(s))' />
                }
            </MudList>
        }
        </MudContainer>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Color="Color.Default" Variant="Variant.Filled">Cancel</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    private string[] FTPList;

    protected async override Task OnInitializedAsync()
    {
        await LoadData();
    }

    protected async Task LoadData()
    {
        FTPList = await Http.GetFromJsonAsync<string[]>($"api/code/ftp?db={currentDB.Current}");
    }

    void Close() => MudDialog.Close(DialogResult.Cancel());
}
